---
title: "STAT 685: Distracted Driving"
subtitle: "Assignment 3"
author: "Bryan Yu: bryanyu@tamu.edu"
output: 
    slidy_presentation:
        highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(magrittr)
source(here::here('src', 'codebase', 'stan_utility.R'))
```

```{r data}
nd_facs_df <- feather::read_feather(here::here("study_df", "facs_nd.feather"))
md_facs_df <- feather::read_feather(here::here("study_df", "facs_md.feather"))
nd_df <- feather::read_feather(here::here("study_df", "nd.feather"))
md_df <- feather::read_feather(here::here("study_df", "md.feather"))
df <- feather::read_feather(here::here("study_df", "df.feather"))

nd_nolanechange <- nd_df %>% dplyr::filter(!dplyr::between(Distance, 5000, 7000))
md_nolanechange <- md_df %>% dplyr::filter(!dplyr::between(Distance, 5000, 7000))
```

## Description

- Determine how lane deviation volatility is affected by texting compared to non-stimulus driving 
    - Phases proceeding stimulus

- Eye gazing / pupilation are explanatory variables to lane positioning / volatility

- Compare lane deviation volatility by cohorts (age, gender, psychometric survey)

```{r, warning=FALSE, fig.align="center"}
ggplot(df, aes(x=Distance, y=Lane.Position)) +
    geom_line(aes(colour=phase)) +
    facet_grid(Drive ~ .) +
    theme_bw() +
    labs(x = 'Distance', y = 'Lane Position (m)') +
    theme(legend.position = "bottom")
```

## First model: A incomplete pass

Trying to capture normal driving volatility without lane change and with age cohort

$$y_n \sim \mathcal{N}(\mu_n, \sigma_n)$$
$$\mu_n\sim \mu_0+ \mu_{age} $$

where $n \in \{ 1, \ldots, 68 \}$ and $j =$ distance

## Sampling methodology

1. Hamiltonian Monte Carlo (HMC)

2. No U-Turn Sampling (NUTS)

## Facial expression data

- Interesting multi-dimensional response to different stimuli (congitive, emotion, sensorimotor)

- Not useful as variables for causal inference of lane volatility 

```{r facial_chart, message=FALSE, warning=FALSE, fig.align="center", fig.width=8}
tall_df <- nd_facs_df %>% 
     dplyr::filter(Time %% 1 == 0) %>%
     tidyr::gather(emotion, value, -subject, -Frame, -Time)

ggplot(tall_df, aes(x=value, color=emotion)) +
    geom_histogram() +
    facet_grid(. ~ emotion) +
    theme_bw() +
    labs(x = 'Time', y = 'Emotional') +
    theme(legend.position = "none")
```



